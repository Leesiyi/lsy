<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="../jquery-3.4.1.js"></script>
    <style>
    *{
        margin: 0;
        padding: 0;
    }
    #floatingbox{
        border: gray 1px solid;
        width: 100px;
        height: 50px;
        position: fixed;
        top: 200px;
        right: 0px;
        z-index: 99999999;
        background-color: #fff;
    }
    #close{
        width: 20px;
        height: 20px;
        position: absolute;
        right: 0;
        display: none;
    }
    #back1{
		z-index: 99999;
        display: none;
        background: rgba(0, 0, 0, 0.498039);
        position: absolute;
        top: 0px;
        width: 100%;
        height: 100%;
	}
    </style>
</head>
<body>
    <div id="back1" style="top: 0px;"></div>
    <div id="floatingbox">
        <div id="close" style="display: none;">x</div>
    </div>
    <script>
        var start_x;   // touchstart时的水平起始位置
        var end_x;     // touchmove过程中的水平结束位置
        var touchmove = false;    // 标识是否成功触发了touchmove，默认没有触发。
        $('#floatingbox').on("touchstart",function(e){ // 触摸开始时
            if (e.originalEvent.targetTouches) {
                start_x = e.originalEvent.targetTouches[0].pageX;
            } else {
                start_x = e.pageX;
            }
            console.log(start_x);
        });
        $('#floatingbox').on("touchmove",function(e){ // 触摸过程中... 
            var width = $(this).width();   // 按钮的宽
            // var right = $(this).css('right');
            if(start_x - end_x >= 5){
                touchmove = true;
            }
            if (e.originalEvent.targetTouches) {
                end_x = e.originalEvent.targetTouches[0].pageX;
            } else {
                end_x = e.pageX;
            }
            if(start_x - end_x >= 0) {  // touchmove 向左移动
                if(parseInt(width) <150){
                    $(this).css('width', 100+(start_x-end_x)+'px');  // 移动宽度变长效果
                }
                // if(parseInt(right) <0){
                //     $(this).css('right', -50+(start_x-end_x)+'px');  // 移动效果
                // }
            }
        });
        $('#floatingbox').on("touchend",function(e){  // 触摸抬起时
                var offset = start_x - end_x;     // 偏移量
                if(touchmove==false) {
                    return;
                }
                if( offset > 0){   // 左滑动
                    if(offset>=30){      // 偏移量大于等于删除按钮的一半
                        // $(this).animate({width:150+'px'},0);  // 动画拉出按钮
                        $(this).css('width', 150+'px');//拉出按钮
                        $("#back1").show();//显示遮盖层
                        $("#close").show();//显示关闭按钮
                        $("body").css("overflow","hidden");
                    }else{
                        // $(this).animate({width:100+'px'},500);  // 动画恢复原状
                        $(this).css('width', 100+'px');  // 恢复原状
                    }
                }
                touchmove = false;
            });
            $('#close').on('click',function(){//点击关闭按钮恢复原状
                $("#back1").hide();
				$("#close").hide();
                $('#floatingbox').css('width', 100+'px'); 
				$("body").css("overflow","auto");
            })
    </script>
</body>
</html>